# 컴퓨터 시스템의 구조

Operating System, OS란?

하드웨어 바로 위에 설치되어 사용자 및 다른 모든 소프트웨어와 하드웨어를 연결하는 소프트웨어 계층

**커널**은 운영체제의 가장 핵심인 부분으로, 메모리에 상주하는 부분이다. 좁은 의미의 운영체제를 부를 때는 **커널**을 뜻한다.

메모리의 상주하지 않고, 주변 시스템 유틸리티도 넓은 의미로 보면 운영체제다.

### 운영체제의 목적

1. 컴퓨터 시스템을 사용하기 편하게 만듬
2. 자원 관리, 최적화

### 운영체제의 분류

- 동시 작업 가능 여부
단일 작업만 가능한지, 다중 작업도 가능한지
→ MS-DOS 프롬포트 상에서는 한 명령의 수행이 끝나기 전엔 여러 작업을 할 수 없음 …
- 사용자의 수
MS-DOS, Windows는 단일 사용자 
Unix, NT server는 다중 사용자
- 처리 방식
    1. 일괄 처리 batch processing
    작업 요청을 일정 량 모아서 한번에 처리
    작업이 완전 종료될 때 까지 기다려야 한다.
    2. 시분할 time sharing
    여러 작업을 수행할 때 컴퓨터 처리 능력을 일정한 시간 단위로 분할하여 사용한다.
    일괄 처리 방식에 비해 짧은 응답 시간을 가진다. 
    interactive한 방식이다.
    ex) UNIX
    3. 실시간 realtime os
    정해진 시간 안에 어떠한 일이 반드시 종료됨이 보장되어야 하는 실시간 시스템을 위한 OS
    예를들어 원자로 제어, 공장 제어, 미사일 제어, 반도체 장비, 로보트 제어 등에서 사용한다.

- Multitasking
- Multiprogramming
메모리에 여러 프로그램이 동시에 올라가있는 것을 뜻함
- Time sharing
CPU가 짧은 시간 간격으로 타임 쉐어링을 하여 나누어 쓴다는 의미다.
- Multiprocess

위의 용어들은 컴퓨터에서 여러 작업들을 동시에 수행하는 것을 뜻하나,

- Multiprocessor
멀티 프로세서는 하나의 컴퓨터에 cpu가 여러 개 붙어 있음을 뜻한다. 운영체제를 배울 때는 다루지 않으나 고성능 클라우드 컴퓨팅에서 다루게된다.

C도 어셈블리에 비하면 고급 언어지만, 어셈블리보다 코드를 쉽게 작성하려고 C언어가 만들어졌다고 한다.

나는 운영체제다.. 나는 리눅스다..

### Mode bit

CPU가 운영체제에 의해서 읽는 기계어가 있을것이고, 사용자 프로그램에 의한 기계어를 읽을 때가 있을 것이다. 이 둘은 구분되어야 한다. → Mode bit이 이것을 처리한다.
Mode bit을 통해 하드웨어적으로 두 가지 모드의 operation을 지원한다.

1. 사용자 모드 : 사용자 프로그램 수행
2. 모니터 모드 (커널 모드 == 시스템 모드) : OS 코드 수행

보안을 해칠 수 있는 중요한 명령어는 모니터 모드에서만 수행 가능하다. → 특권 명령

program counter register라는 레지스터가 있다. 이녀석은 메모리에 있는 읽을 기계어의 주소를 가지고 있다. 이 주소로  cpu가 어떤 프로그램을 실행중인지 알 수 있다. (OS 관련된 프로그램인지, 사용자 프로그램인지)

### Timer

CPU의 독점을 막기 위해서 Timer라는 하드웨어를 사용한다. 만약 실행중인 어떤 프로그램이 무한 루프에 걸렸다면, 타이머가 cpu에게 인터럽트를 걸어 운영체제에게 주도권을 넘긴다.  
→ Round Robin 방식이 Timer를 이용해서 만들어진 것 같다.

### System call

CPU가 IO 명령을 처리할 때는 Mode bit이 커널 모드가 되어 연산을 처리한다. 즉 사용자 프로그램은 IO를 처리할 수 없다. 그래서 사용자 프로그램은 IO를 처리하고 싶으면 OS에 부탁을 해야하는데, 그것이 시스템 콜 함수 System call이다.

사용자 프로그램이 실행중일 때 운영체제의 도움을 받아야 할 때가 있다. 이것은 프로그램 스스로가 인터럽트를 발생시켜야 하는데, 이 작업을 System call 함수로 할 수 있다.

### Interrupt

인터럽트 당한 시점의 레지스터와 program counter를 저장한 후 cpu의 제어를 인터럽트 처리 루틴에 넘긴다.

1. Interrupt 하드웨어 인터럽트
2. Trap 소프트웨어인터럽트
exception : 프로그램이 오류를 범한 경우
System call : 프로그램이 커널 함수를 호출한 경우

인터럽트 벡터 
→ 해당 인터럽트의 처리해야할 주소를 가지고 있음

인터럽트 처리 루틴 ( == interrupt service routine, 인터럽트 핸들러)
→ 운영체제 커널에 있는 함수다. 해당 인터럽트에 대해서 무슨 일을 해야하는지 적혀 있다.

하드웨어의 io 작업이 끝났다면 cpu가 직접 접근하는 것이 아닌 처리된 하드웨어의 device controller가 cpu에 인터럽트를 걸어 처리된다.

### Device Controller

- 해당 IO 장치를 관리하는 일종의 작은 cpu다.
- 제어를 위해 control register, status register를 가진다.
- local buffer를 가진다. (일종의 data register)

IO는 실제 device와 local buffer 사이에서 일어난다.

하드웨어에 io 처리를 해주는 것은 하드웨어 내부에 있는 펌웨어가 처리한다.

device driver → cpu가 입출력을 요청할 때 하드웨어에게 요청을 보내는 운영체제에 설치된 소프트웨어다. cpu가 사용하는 프로그램이다.

 

### 동기식 입출력 synchronous IO 과 비동기식 입출력 asynchronous

cpu와 하드웨어간의 작업 싱크가 맞아야 되면 동기식 IO, 

그렇지 않다면 비동기식
두 경우 I/O의 완료는 모두 인터럽트로 알려줌

### DMA Direct Memory Acces

인터럽트도 오버헤드다. 고속 IO장치가 있다면 그 장치가 자주 인터럽트를 걸 텐데, 그것은 비효율적인 상황이다.

인터럽트가 너무 자주 걸리는걸 방지하기 위해 DMA controller가 존재한다.
IO가 끝났을 때 device controller가 인터럽트를 걸어 cpu가 직접 device controller에 접근해 local buffer에 있는 데이터를 메모리로 복사해오는 것이 아닌, DMA controller가 메모리에 복사한 후 인터럽트를 걸어 cpu가 처리한다.

cpu의 중재 없이 device controller가 device의 buffer storage의 내용을 **block** 단위로 직접 전송한다.
(byte 단위가 아니라 block 단위로 인터럽트를 건다.

### 입출력 기계어를 수행하는 방법

IO를 통해 기계어를 수행하는 방법은 두 가지 있다.

1. IO를 전담하는 기계어(명령어)를 두는 방법이다. 메모리에 접근하는 기계어 따로, IO 수행하는 기계어 따로
2. IO장치에도 메모리 주소를 매겨놓고, 메모리 접근하는 기계어를 통해 IO장치에 접근하는 방법

## 궁금한 점

---

 1. 데비안같은것은 단일 작업만 가능한건가?

1. window는 단일사용자???
→ 윈도우도 다중 사용이 되는 것 같은데, 유닉스보다 덜 발달해서 그렇게 말 한것 같다.
2. 사용자를 나누는 이유?
권한을 조정하기 위해서.. root 권한을 부여하지 않고 sudo로 한번 거러주는 것 만으로도 보안이 향상된다. root는 커널을 건들 수 있지만 sudo를 통하면 불가능
3. 윈도우는 무슨 언어로 쓰였나?
→ C로 쓰였다.
4. 디바이스 컨트롤러, 드라이버가 좀 헷갈리고, 디바이스 컨트롤러에 local buffer가 뭔지 모르겠다.
5. 동기식 입출력, 비동기식 입출력은 어느 상황에서 쓰는지?
6. DMA에 거쳐서서 전송되는 고속 IO장치는 무엇이 있는지?
→ 하드디스크, 그래픽카드, 네트워크 카드, 사운드 카드 등

### 더 알아볼 점

---

PCB 개념에 대해 공부

논리, 비동기 영상 보기
[https://www.youtube.com/results?search_query=동기+비동기+블로킹+논블로킹](https://www.youtube.com/results?search_query=%EB%8F%99%EA%B8%B0+%EB%B9%84%EB%8F%99%EA%B8%B0+%EB%B8%94%EB%A1%9C%ED%82%B9+%EB%85%BC%EB%B8%94%EB%A1%9C%ED%82%B9)